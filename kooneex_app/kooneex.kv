ScreenManager:
    LoginScreen:
    ViajeScreen:
    PendientesScreen:
    TarifaScreen:
    ViajeEnCursoScreen:

<LoginMDTextField@MDTextField>:
    fill_color: 1, 1, 1, 0.25
    text_color: 1, 1, 1, 1
    hint_text_color: 1, 1, 1, 0.8
    icon_right_color: 1, 1, 1, 1
    line_color_focus: 1, 1, 1, 1
    font_name: "Poppins"
    mode: "fill"

<LoginScreen>:
    name: "login"
    username: username.text
    password: password.text
    show_password: False #Variable para poder manejar el mostrar o ocultar la contrasena
    background_orange_color : 0.9686, 0.5765, 0.1176, 1 #Definimos el color para todo el fondo de la app
    font_white_color : 1, 1, 1, 1

    MDFloatLayout:
        md_bg_color: root.background_orange_color
        MDBoxLayout:
            orientation: 'vertical'
            spacing: "24dp"
            padding: "40dp"
            size_hint: 0.9, 0.7
            pos_hint: {"center_x": 0.5, "center_y": 0.5}
            Image:
                source: "assets/kooneex_logo.png"
                size_hint: (0.8, None)
                height: "150dp"
                allow_stretch: True
                keep_ratio: True
                pos_hint: {"center_x": 0.5}
            MDLabel:
                text: "Iniciar Sesión"
                halign: "center"
                valign: "middle"
                size_hint_y: None
                height: self.texture_size[1]
                font_name: "Poppins"
                bold: True
                font_style: "H5"
                theme_text_color: "Custom"
                text_color: root.font_white_color
            LoginMDTextField:
                id: username
                hint_text: "Usuario"
                icon_right: "account"
                
            LoginMDTextField:
                id: password
                hint_text: "Contraseña"
                password: not root.show_password  # cambia dinámicamente
                icon_right: "eye-off" if not root.show_password else "eye"
                on_icon_right: root.toggle_password_visibility()

            MDRaisedButton:
                text: "Ingresar"
                md_bg_color: 1, 1, 1, 1
                text_color: 0.9686, 0.5765, 0.1176, 1
                font_name: "Poppins"
                pos_hint: {"center_x": 0.5}
                on_release: root.login()
            
            MDLabel:
                id: mensaje_label
                text: root.mensaje
                halign: "center"
                theme_text_color: "Custom"
                text_color: root.font_white_color
                font_name: "Inter"

<ViajeScreen>:
    name: "viaje"

    MDFloatLayout:
        md_bg_color: 0.9686, 0.5765, 0.1176, 1

        # --- MAPA ---
        MapView:
            id: mapa
            zoom: 15
            lat: 19.4326
            lon: -99.1332
            size_hint: 1, 1
            pos_hint: {"x": 0, "y": 0}

        # --- CONTENEDOR DE LOS CAMPOS ---
        MDBoxLayout:
            orientation: "vertical"
            size_hint: 0.9, None
            height: dp(130)
            spacing: dp(10)
            pos_hint: {"top": 0.97, "center_x": 0.5}

            MDTextField:
                id: txt_origen
                hint_text: "Origen"
                mode: "rectangle"
                on_text: root.buscar_direccion(self.text, "origen")

            MDTextField:
                id: txt_destino
                hint_text: "Destino"
                mode: "rectangle"
                on_text: root.buscar_direccion(self.text, "destino")

        # --- BOTÓN SOLICITAR VIAJE ---
        MDRaisedButton:
            text: "Solicitar viaje"
            size_hint: 0.6, None
            height: dp(48)
            pos_hint: {"center_x": 0.5, "y": 0.05}
            md_bg_color: 0, 0.5, 0.2, 1
            on_release: root.solicitar_viaje()

        # --- MENSAJE ---
        MDLabel:
            id: mensaje_label
            text: root.mensaje
            halign: "center"
            valign: "middle"
            size_hint_y: None
            height: dp(30)
            pos_hint: {"center_x": 0.5, "y": 0.01}
            theme_text_color: "Custom"
            text_color: 1, 1, 1, 1

<ViajeEnCursoScreen>:
    name: "viaje_en_curso"
    MDFloatLayout:
        md_bg_color: 0.9686, 0.5765, 0.1176, 1  # #F7931E
        BoxLayout:
            orientation: "vertical"
            padding: 20
            spacing: 10

            MDLabel:
                id: info_label
                text: "Cargando información del viaje..."
                theme_text_color:"Custom"
                text_color:(1, 1, 1, 1)
                font_style:"H6"
                pos_hint: {"center_x": 0.5}
            
            MDRaisedButton:
                text: "Marcar como completado"
                md_bg_color: 0.2, 0.2, 0.2, 1
                size_hint: 1, None
                height: 50
                on_release: root.marcar_completado()

<ViajeEnCursoMotoScreen>:
    name: "viaje_en_curso_moto"
    MDFloatLayout:
        md_bg_color: 0.9686, 0.5765, 0.1176, 1  # #F7931E
        BoxLayout:
            orientation: "vertical"
            padding: 20
            spacing: 10

            MDLabel:
                id: info_label
                text: "Cargando viaje en curso..."
                theme_text_color:"Custom"
                text_color:(1, 1, 1, 1)
                font_style:"H6"
                size_hint_x: .5
                pos_hint: {"center_x": 0.5}

            MDRaisedButton:
                id: btn_iniciar
                text: "Iniciar viaje"
                md_bg_color: (0.2, 0.2, 0.2, 1)
                size_hint: (1, None)
                height: 90
                on_release: root.iniciar_viaje()
            
            MDRaisedButton:
                id: btn_completar
                text: "Marcar como completado"
                md_bg_color: 0.2, 0.2, 0.2, 1
                size_hint: 1, None
                height: 50
                on_release: root.marcar_completado()

<PendientesScreen>:
    name: 'pendientes'
    MDFloatLayout:
        md_bg_color: 0.9686, 0.5765, 0.1176, 1  # #F7931E
        BoxLayout:
            orientation: "vertical"
            padding: 10
            spacing: 10

            Label:
                text: "Viajes Pendientes"
                font_size: 22
                bold: True
                size_hint_y: None
                height: 40
                color: 1, 1, 0, 1

            ScrollView:
                do_scroll_x: False
                do_scroll_y: True
                GridLayout:
                    id: viajes_container
                    cols: 1
                    size_hint_y: None
                    height: self.minimum_height
                    spacing: 10
            Label:
                id: notificacion_label
                text: ""
                size_hint_y: None
                height: 30
                color: 0, 1, 0, 1
                halign: "center"
        
<TarifaScreen>:
    MDFloatLayout:
        md_bg_color: 0.9686, 0.5765, 0.1176, 1  # #F7931E
        BoxLayout:
            orientation: "vertical"
            padding: 10
            spacing: 10

            Label:
                text: "Ofertas de Mototaxistas"
                font_size: 22
                bold: True
                size_hint_y: None
                height: 40
                color: 1, 1, 0, 1

            ScrollView:
                do_scroll_x: False
                do_scroll_y: True

                GridLayout:
                    id: tarifas_container
                    cols: 1
                    size_hint_y: None
                    height: self.minimum_height
                    spacing: 10

            Label:
                id: mensaje_tarifas
                text: ""
                size_hint_y: None
                height: 30
                color: 0, 1, 0, 1

<ViajeCard@BoxLayout>:
    orientation: "vertical"
    size_hint_y: None
    height: "170dp"
    padding: 10
    spacing: 5

    # Variables que Python rellenará
    viaje_id: ""
    usuario: ""
    cantidad: ""
    costo: ""
    tarifa_textinput: tarifa_input_id

    Label:
        text: "Viaje #" + root.viaje_id
        color: (1, 1, 0, 1)
        font_size: "18sp"

    Label:
        text: "Usuario: " + root.usuario
        color: (1,1,1,1)

    Label:
        text: "Pasajeros: " + root.cantidad
        color: (1,1,1,1)

    Label:
        text: "Tarifa sugerida: $" + root.costo
        color: (1,1,1,1)

    TextInput:
        id: tarifa_input_id
        hint_text: "Tu tarifa"
        multiline: False
        size_hint_y: None
        height: "40dp"
        input_filter: "float"
        text: root.costo

    BoxLayout:
        size_hint_y: None
        height: "40dp"
        spacing: 10

        Button:
            text: "Sugerir tarifa"
            background_color: (0, 1, 0, 1)
            on_release: app.root.sugerir_tarifa(root.viaje_id, tarifa_input_id.text)

        Button:
            text: "Rechazar"
            background_color: (1, 0, 0, 1)
            on_release: app.root.rechazar_viaje(root.viaje_id)

<SelectorLugares@BoxLayout>:
    tipo: ""
    parent_screen: None
    orientation: "vertical"
    size_hint_y: None
    height: dp(320)
    padding: dp(20)
    spacing: dp(15)

    MDLabel:
        text: "Seleccionar " + root.tipo
        font_style: "H6"
        halign: "center"

    MDRaisedButton:
        text: "Ubicación actual"
        on_release:
            root.parent_screen.set_lugar(root.tipo, "Ubicación actual", 19.4326, -99.1332)
            app.root_window.children[0].dismiss()

    MDRaisedButton:
        text: "Casa"
        on_release:
            root.parent_screen.set_lugar(root.tipo, "Casa", 19.4326, -99.1332)
            app.root_window.children[0].dismiss()

    MDRaisedButton:
        text: "Trabajo"
        on_release:
            root.parent_screen.set_lugar(root.tipo, "Trabajo", 19.44, -99.15)
            app.root_window.children[0].dismiss()

    MDRaisedButton:
        text: "Terminal"
        on_release:
            root.parent_screen.set_lugar(root.tipo, "Terminal", 19.4280, -99.10)
            app.root_window.children[0].dismiss()

    MDRaisedButton:
        text: "Centro"
        on_release:
            root.parent_screen.set_lugar(root.tipo, "Centro", 19.45, -99.14)
            app.root_window.children[0].dismiss()

    MDFlatButton:
        text: "Seleccionar en el mapa"
        on_release:
            root.parent_screen.mensaje = "Haz clic en el mapa para elegir"
            app.root_window.children[0].dismiss()